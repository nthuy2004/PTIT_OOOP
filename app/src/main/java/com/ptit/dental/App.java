///*
// * This source file was generated by the Gradle 'init' task
// */
package com.ptit.dental;

import com.ptit.dental.controller.*;
import com.ptit.dental.model.dao.AppointmentDAO;
import com.ptit.dental.model.dao.MedicalRecordDAO;
import com.ptit.dental.model.dao.PatientDAO;
import com.ptit.dental.model.dao.StaffDAO;
import com.ptit.dental.model.service.AuthService;
import com.ptit.dental.utils.Database;
import com.ptit.dental.utils.Injector;
import com.ptit.dental.view.*;

import javax.swing.*;

public class App {
    public static void main(String[] args) {

        try {
            Database db = Database.getInstance();
            java.sql.Connection conn = db.getConnection();

            if (conn == null || conn.isClosed()) {
                throw new Exception("lmao error");
            }

            StaffDAO staffDAO = new StaffDAO(conn);
            AppointmentDAO aDAO = new AppointmentDAO(conn);
            PatientDAO pDAO = new PatientDAO(conn);
            MedicalRecordDAO medicalRecordDAO = new MedicalRecordDAO(conn);
            AuthService authService = new AuthService(staffDAO);

            Injector.register(StaffDAO.class, staffDAO);
            Injector.register(AppointmentDAO.class, aDAO);
            Injector.register(PatientDAO.class, pDAO);
            Injector.register(MedicalRecordDAO.class, medicalRecordDAO);
            Injector.register(AuthService.class, authService);
        } catch (Exception e) {
            System.err.println("DB INIT ERROR: " + e.getMessage());
            e.printStackTrace();

            SwingUtilities.invokeLater(() -> {
                JOptionPane.showMessageDialog(null,
                        e.getMessage(),
                        "Error",
                        JOptionPane.ERROR_MESSAGE);
            });
        }

        SwingUtilities.invokeLater(() -> {
            try {
                UIManager.setLookAndFeel("javax.swing.plaf.nimbus.NimbusLookAndFeel");
            } catch (Exception e) {
                System.err.println("THEME ERROR: " + e.getMessage());
            }

            LoginView loginView = new LoginView();
            LoginController loginController = new LoginController(loginView);

            loginController.setOnLoginSuccess(() -> {
                new MainDashboardController(new MainDashboardView()).show();
            });

            loginController.show();
        });
    }
}
